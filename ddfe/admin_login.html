<!DOCTYPE html>
<html>
<head>
	<title>Admin</title>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="PublicCSS/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="PublicCSS/bootstrap-theme.min.css">
	<script src="PublicJs/jquery.js"></script>
	<script src="PublicJs/http.js"></script>
	<script src="PublicJs/jQuery.md5.js"></script>
</head>
<body>
	<div id="loginDiv" style="padding:20px;background-color: #e9e9e9;">
		<input type="text" id="username" placeholder="用户名" required="" autofocus="">

		<input type="password" id="password" placeholder="密码" required="">
		<button class="btn btn-xs btn-success" type="button" onclick="user.login()">登陆</button>
    </div>

    <!-- 内容输出 -->
    <div class="container" id="output"></div>

    <!-- <button onclick="user.vertify()">test</button> -->
<script>
var requestfront_admin = "../ddbe/api.admin.php?";
var requestfront_be = "../ddbe/api.php?";

$(document).ready(function(){
	user.vertify();
});

var user = {
	vertify : function() {
		var resqurl = requestfront_admin + "action=admin_vertifytoken";
		http_method.ajaxmethod(resqurl,null,"GET","json",callback.finishvertify);
	},
	login : function() {
		var wx_admin_user = $("#username").val();
		var wx_admin_pass = $.md5($('#password').val());

		var resqurl = requestfront_admin + "action=admin_login";

		data = {
			wx_admin_user : wx_admin_user,
			wx_admin_pass : wx_admin_pass,
		};

		http_method.ajaxmethod(resqurl,data,"POST","json",callback.finishlogin);
	}
};

var questions = {
	getunsolvelist : function() {
		var resqurl = requestfront_admin + "action=admin_getlist";
		var data = {
			state : '0',
		}
		http_method.ajaxmethod(resqurl,data,"POST","json",callback.finishgetunsolvelist);
	},
};

var callback = {
	finishvertify : function(result) {
		console.log(result);
		if (result.resp == 'true' || result.resp == true ) {
			$("#loginDiv").hide();
		} else {
			$("#loginDiv").show();
			questions.getunsolvelist();
		}
	},
	finishlogin : function(result) {
		if (result.resp == 'false' || result.resp == false ) {
			alert("用户名或者密码错误，请重新登陆");
		} else {
			$("#loginDiv").hide();
			questions.getunsolvelist();
		}
	},
	finishgetunsolvelist : function(result) {
		console.log(result);
		/*
		<div class="jumbotron">
			<h1>Theme example</h1>
			<p>This is a template showcasing the optional theme stylesheet included in Bootstrap. Use it as a starting point to create something more unique by building on or modifying it.</p>
		</div>
		*/

		var content = "";
		for(var object in result.resp){
			content += '<div class="jumbotron">'
			+ '<h1>' + result.resp[object].wx_questions_content.substr(0,10) + '</h1>'
			+ '<p>'
			+ result.resp[object].wx_questions_content
			+ '<hr>'
			+ Trans_php_time_to_str(result.resp[object].wx_questions_id,1);
			+ '<br>' + result.resp[object].wx_questions_place
			+ '</p>'
			+ '</div><br>';
		}

		$("#output").html(content);
	},
};

</script>

</body>
</html>